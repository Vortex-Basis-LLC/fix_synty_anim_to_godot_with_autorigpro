# Retarget Batcher via ARP

NOTE: This tool requires that you already have Auto-Rig Pro installed in Blender.
If you don't have Auto-Rig Pro, you can buy it here (I have no affiliation with
makers of Auto-Rig Pro, but it is a pretty useful tool):
https://blendermarket.com/products/auto-rig-pro

This extensions will reset a set of FBX animations to a common rest pose and export
them in groups to a series of GLB files.

The purpose of this tool is to fixup Synty's animation libraries and package them
into GLB libraries that are easily usable within Godot.

# Known Issues
Root-motion animations need some work, but the in-place animations should all be good.

# Basic Instructions

- Install/enable Auto-Rig Pro in Blender.
- Download the extension release zip and drop into Blender to install.
  - fix_synty_anim_to_godot_with_autorigpro_v1_0_0.zip
- Purchase Synty animation packs and unzip Blender source files under a common directory.
  - [Synty Store](https://syntystore.com)
  - The T-Pose from ANIMATION - Base Locomotion is needed (or you'll have to create your own T-Pose).
- Unzip all Synty animation packs you own under a common folder.
- Start new Blender project and delete all objects in the scene (the cube, camera, and light).
- Go to "Fix Synty Anim To Godot With ARP" tab in the side panel ("N" menu on the Viewport).
- Click "Batch Retarget" once to have "Anim Config CSV" automatically setup with preconfigured CSV that references all known Synty animations.
- Set "Import Path" to root folder containing all your Synty animations.
- Set "Export Path" to root folder that will contain all exported GLB files (one for each "group" name in the Anim Config CSV)
- Click "Batch Retarget".
- Wait a while (maybe 20 minutes on a reasonably fast machine).
- Your export path will now contain GLB files usable as animation libraries in Godot.

To use the GLB files in Godot:
- Drag and drop GLB files into your Godot FileSystem.
- Select each GLB file, go to "Import" tab.
	- Change "Import As" to "Animation Library"
	- Check "Trimming", "Remove Immutable Tracks", and "Import Rest as Reset".
	- Click "Reimport"
	- Click "Advanced"
	- Select "Skeleton3D" in scene browser. Create bone map (or use synty_anim_bone_map.tres in extension folder)
	- Click "Reimport"

To add animations to your character:
- With AnimationPlayer for your character selected:
  - In Animation tab, click Animation button then "Manage Animations"
  - Load library and then pick one of the GLB files you imported.


# Notes about generation of synty_anim_metadata.csv
- List was generated by initially crawling folder, dumping list of FBX names, and remove non-animation FBXs.
- loop column was calculated in Excel as follows:
```
=AND(NOT(OR(ISNUMBER(SEARCH("_Begin_",A2)),ISNUMBER(SEARCH("_End_",A2)),ISNUMBER(SEARCH("_ReturnTo",A2)),ISNUMBER(SEARCH("_To",A2)),ISNUMBER(SEARCH("_Enter",A2)),ISNUMBER(SEARCH("_Exit",A2)))), OR(ISNUMBER(SEARCH("Idle",A2)),ISNUMBER(SEARCH("Walk",A2)),ISNUMBER(SEARCH("Run",A2)),ISNUMBER(SEARCH("Sprint",A2)),ISNUMBER(SEARCH("Shuffle_",A2)),ISNUMBER(SEARCH("Crouch_",A2)),ISNUMBER(SEARCH("_Additive_",A2)),ISNUMBER(SEARCH("_Loop",A2))))
```
- root_motion column was calculated in Excel as follows:
```
=OR(ISNUMBER(SEARCH("RootMotion", A2)),ISNUMBER(SEARCH("_RM_", A2)))
```